<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Space Bullet Hell</title>
</head>

<body>
    <canvas id="canvas" style="background:url('./Bildes/Backround.png'); margin: auto; display: block; height: 98vh; width: 65vh;"></canvas>

    <script>
        class Bullet{
            constructor(sakuma_x, sakuma_y){
                this.PlayerBulletImg = new Image;
                this.PlayerBulletImg.src = "./Bildes/PlayerBullet.png";
                this.bullet_x = sakuma_x;
                this.bullet_y = sakuma_y;
            }            
        }

        class Bullet2{
            constructor(sakuma_x, sakuma_y){
                this.PlayerBulletImg = new Image;
                this.PlayerBulletImg.src = "./Bildes/EnemyBullet.png";
                this.bullet_x = sakuma_x;
                this.bullet_y = sakuma_y;
            }            
        }

        

        var lodes = [];
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth * 0.65;
        canvas.height = window.innerHeight * 0.98;

        var HealthUp = 5;
        var ShieldUp = 5;
        var DamageUP = 10;

        // if buyShield{
        //     ship_shieldMAX++;
        //     ship_shieldCurrent++;
        //     ShieldUp--;
        // }
        // if buyHealth{
        //     ship_healthMAX++;
        //     ship_healthCurrent++;
        //     HealthUP--;
        // }

        var shipImg = new Image;
        shipImg.src = "./Bildes/Ship1.2.png";
        var shipWidth = 96;
        var shipHeight = 128;
        var ship_x = (canvas.width-shipWidth)/2;
        var ship_y = canvas.height-shipHeight;
        var ship_speed = 3;
        var ship_healthMAX = 10;
        var ship_healthCurrent = 7;
        var ship_side_speed = 0;
        var ship_shieldMAX = 5;
        var ship_shieldCurrent = 2;
        var ship_damage = 0;
        var ship_bullet_speed = 0;

        var ship2Img = new Image;
        ship2Img.src = "./Bildes/Ship1.3.png";
        var ship2Width = 96;
        var ship2Height = 128;
        var ship2_x = (canvas.width-shipWidth)/2;
        var ship2_y = canvas.height-shipHeight;
        var ship2_speed = 3;
        var ship2_healthMAX = 10;
        var ship2_healthCurrent = 7;
        var ship2_side_speed = 0;
        var ship2_shieldMAX = 5;
        var ship2_shieldCurrent = 2;
        var ship2_damage = 0;
        var ship2_bullet_speed = 0;

        // var enemy1Img = new Image;
        // enemy1Img.src = "./Bildes/Enemy/Enemy1.2.png"; 
        // var enemy1Width = 250;
        // var enemy1Height = 256;
        // var enemy1_x = (canvas.width-enemy1Width)/2;
        // var enemy1_y = 20;
        // var enemy1_speed = 0;
        // var enemy1_side_speed = 0;
        // var enemy1health = 0;
        // var enemy1_damage = 0;
        // var enemy1_bullet_speed = 0;


        var IsPlayerShooting = 0;
        var  PlayerBullet_x = 100;
        var  PlayerBullet_y = 100;

        // var enemyImg = new Image;
        // enemyImg.src = ""; 
        // var enemyWidth = 0;
        // var enemyHeight = 0;
        // var enemy_x = 0;
        // var enemy_y = 0;
        // var enemy_speed = 0;
        // var enemy_side_speed = 0;
        // var enemy_health = 0;
        // var enemy_damage = 0;
        // var enemy_bullet_speed = 0;

        // var score = 123456;
        // var time_remaining = 300;


        // function restart_game() {
        //     time_remaining = 300;
        //     score = 0;
        // }





        // raimja mēģinājumi 
            var HealthHeight = 30;
            var HealthWidth = 30;
            var Health_x = (canvas.width-HealthWidth)/2;
            var Health_y = canvas.height-HealthHeight;

            //full hp
            var HealthBar = new Image;
            HealthBar.src = "./Bildes/HeartFull.png";

            //empty hp   
            var EmptyHP = new Image;
            EmptyHP.src = "./Bildes/HeartEmpty.png";

            // //full shield
            // var ShieldFull = new Image;
            // ShieldFull.src = "./Bildes/ShieldFull.png";

            // //empty shield
            // var ShieldEmpty = new Image;
            // ShieldEmpty.src = "./Bildes/ShieldEmpty.png";

            // var ShieldHeight = 32;
            // var ShieldWidth = 26;

 

        

        document.addEventListener("keydown", handleKeyDown);
        document.addEventListener("keyup", handleKeyUp);

        var keys = {}; 

        function handleKeyDown(event) {
            keys[event.key] = true;
        }

        function handleKeyUp(event) {
            keys[event.key] = false;
        }

        function update() {
            // Controls
            if (keys['w']) { // Move up
                ship_y -= ship_speed;
            }
            if (keys['s']) { // Move down
                ship_y += ship_speed;
            }
            if (keys['a']) { // Move left
                ship_x -= ship_speed;
            }
            if (keys['d']) { // Move right
                ship_x += ship_speed;
            }
            if (keys[' ']) {// shoot 
                lodes.push(new Bullet(ship_x, ship_y));
                // IsPlayerShooting = 1;
                // console.log("IsPlayerShooting: " + IsPlayerShooting);
            }

            if (ship_x < -20) {     //Keeps ship within the x canvas boundaries
                ship_x = -20;
            } else if (ship_x > canvas.width - shipWidth + 20) {
                ship_x = canvas.width - shipWidth + 20;
            } if (ship_y < 0) {     //Keeps ship within the y canvas boundaries
                ship_y = 0;
            } else if (ship_y > canvas.height - shipHeight) {
                ship_y = canvas.height - shipHeight;
            }
            
            // Controls
            if (keys['i']) { // Move up
                ship2_y -= ship2_speed;
            }
            if (keys['k']) { // Move down
                ship2_y += ship2_speed;
            }
            if (keys['j']) { // Move left
                ship2_x -= ship2_speed;
            }
            if (keys['l']) { // Move right
                ship2_x += ship2_speed;
            }
            
            if (keys['n']) {// shoot 
                lodes.push(new Bullet2(ship2_x, ship2_y));
                // IsPlayerShooting = 1;
                // console.log("IsPlayerShooting: " + IsPlayerShooting);
            }

            if (ship2_x < -20) {     //Keeps ship within the x canvas boundaries
                ship2_x = -20;
            } else if (ship2_x > canvas.width - ship2Width + 20) {
                ship2_x = canvas.width - ship2Width + 20;
            } if (ship2_y < 0) {     //Keeps ship within the y canvas boundaries
                ship2_y = 0;
            } else if (ship2_y > canvas.height - ship2Height) {
                ship2_y = canvas.height - ship2Height;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // console.log("Canvas height: " + canvas.height)
            // console.log("Canvas width: " + canvas.width)

            ctx.drawImage(shipImg, ship_x, ship_y);
            // console.log("Ship height: " + shipImg.height)
            // console.log("Ship width: " + shipImg.width)

            ctx.drawImage(ship2Img, ship2_x, ship2_y);

            
            // ctx.drawImage(enemy1Img, enemy1_x, enemy1_y);
            // console.log("Enemy1 height: " + enemy1Img.height)
            // console.log("Enemy1 width: " + enemy1Img.width)

            for(var i=0;i<ship_healthMAX;i++){
                ctx.drawImage(HealthBar, Health_x +(i*30), Health_y);
                // console.log("HealthBar height: " + HealthBar.height)
                // console.log("HealthBar width: " + HealthBar.width)
            }
            for(var j=ship_healthMAX;j>ship_healthCurrent;j--){
                ctx.drawImage(EmptyHP, Health_x +(j*30), Health_y);
                // console.log("EmptyHP height: " + EmptyHP.height)
                // console.log("EmptyHP width: " + EmptyHP.width)
            }
          
            for(lode in lodes){
                ctx.drawImage(lodes[lode].PlayerBulletImg, lodes[lode].bullet_x, lodes[lode].bullet_y);
                lodes[lode].bullet_y -=1;
                if (lodes[lode].bullet_y<=20){
                    delete lodes[lode];
                }
            }



            // if (IsPlayerShooting == 1) {
            //     ctx.drawImage(PlayerBulletImg, PlayerBullet_x, PlayerBullet_y);
            //     console.log("PlayerBulletImg height: " + PlayerBulletImg.height)
            //     console.log("PlayerBulletImg width: " + PlayerBulletImg.width)
            //     PlayerBullet_y = PlayerBullet_y+1;
            //     IsPlayerShooting = 0;
            // }
            //hp
            for(var i=1;i<ship_healthMAX;i++){
                ctx.drawImage(HealthBar, Health_x +(i*30), Health_y - 40);

            }
            for(var j=ship_healthMAX;j>ship_healthCurrent;j--){
                ctx.drawImage(EmptyHP, Health_x +(j*30), Health_y - 40);
    
            }
            // //shield
            // for(var k=1;k<ship_shieldMAX;k++){
            //     console.log("asdasdg");
            //     ctx.drawImage(ShieldFull, Health_x +(k*26), Health_y - 8);

            // }
            // for(var l=ship_shieldMAX;l>ship_shieldCurrent;l--){
            //     ctx.drawImage(ShieldEmpty, Health_x +(l*26), Health_y - 8);

            // }
            
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function ImagesTouching(bullet_x, bullet_y, PlayerBulletImg, ship2_x, ship2_y, ship2Img) {
            if (bullet_x >= ship2_x+ship2Img.width || bullet_y+PlayerBulletImg.width <= ship2_x) return false;
            if (bullet_y >= ship2_y+ship2Img.height || bullet_y+PlayerBulletImg.height <= ship2_) return false;
            return true;                                                    
        }


        gameLoop();

    </script>
</body>
</html>